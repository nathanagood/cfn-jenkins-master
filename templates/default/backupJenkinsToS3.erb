#!/bin/bash

JENKINS_HOME=/var/lib/jenkins
JOBS_HOME=${JENKINS_HOME}/jobs
ARCHIVE=/tmp/jenkins-jobs-backup.tgz

# TAR up the Jenkins workspace directory
(cd ${JOBS_HOME} && tar -cf - * | gzip > ${ARCHIVE})

# So long as the backup was successful, copy the backup up to S3. There are no credentials
# supplied here because the assumption is made that the server has a role associated with it
# that allows it to access S3. If there are credentials required, consider using Chef to place
# those credentials in the right place.
if [ $? -eq 0 ]; then
  echo "Uploading archive to S3..."
fi